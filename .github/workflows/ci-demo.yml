name: CI pipeline - demo
on:
  push:
    branches:
      - ci-demo
  pull_request:
    types: [opened, synchronize, reopened]

jobs:

  setup:
    name: Setup
    runs-on: ubuntu-latest
    steps:
     - name: Clone repo
       uses: actions/checkout@v2
       with:
        fetch-depth: 0  # Shallow clones should be disabled for a better relevancy of analysis
     - name: Install requirements
       run: make verify || make setup
     - name: Define metadata for commits
       run: |
        git config user.name "Your Name"
        git config user.email "your@mail.com"

  start:
    name: start
    needs: setup
    runs-on: ubuntu-latest
    steps:
      - name: start
        run: echo "..."

  step1:
    runs-on: ubuntu-latest
    needs: [setup, start]
  
  step2:
    needs: [setup, start, step1]
  
  step3:
    needs: [setup, start, step1, step2]
    
  step4:
    name: step4
    needs: [setup, start, step1, step2, step3]
    runs-on: ubuntu-latest
    steps:
      - name: sonarcloud scan
        uses: SonarSource/sonarcloud-github-action@master
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # Needed to get PR information, if any
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}

  step5:
    needs: [setup, start, step1, step2, step3, step4]
  
  step6:
    needs: [setup, start, step1, step2, step3, step4, step5]
  
  step7:
    needs: [setup, start, step1, step2, step3, step4, step5, step6]
  
  step8:
    needs: [setup, start, step1, step2, step3, step4, step5, step6, step7]
  
  step9:
    needs: [setup, start, step1, step2, step3, step4, step5, step6, step7, step8]
